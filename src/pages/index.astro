---
import BaseLayout from '../layouts/BaseLayout.astro'
import { FemHeroSection } from '../components/FemHeroSection'
import { getCollection } from 'astro:content'

const posts = (await getCollection('blog'))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3)
---

<BaseLayout lang="en">
  <div class="animate-page-in">
    <!-- Hero section -->
    <section class="mx-auto max-w-5xl px-6 pt-10 pb-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-start">
        <!-- Intro text (static HTML, renders instantly) -->
        <div class="lg:order-2 lg:pl-2">
          <p class="text-xs font-mono text-[var(--color-accent)] uppercase tracking-widest mb-3">
            Scientific Engineer & AI Builder
          </p>
          <h1 class="font-[var(--font-display)] text-5xl lg:text-[3.5rem] leading-[1.1] text-[var(--color-text)] mb-5">
            Charles Azam
          </h1>
          <p class="text-[15px] leading-relaxed mb-4 text-[var(--color-text)]">
            The frame on the left is a real finite element solver running in your browser —
            assembling stiffness matrices, solving eigenvalue problems, rendering mode shapes.
            I bring the same engineering rigor to AI systems.
          </p>
          <p class="text-sm text-[var(--color-text-muted)] mb-6 leading-relaxed">
            Currently building a company in stealth, while offering consulting and training
            to engineering teams. Previously Head of Software at Jimmy Energy, transforming traditional
            workflows into code-driven systems.
          </p>
          <div class="flex gap-4">
            <a href="https://www.linkedin.com/in/charles-azam-a4223b135/" target="_blank" rel="noopener noreferrer" class="text-sm font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors">LinkedIn</a>
            <a href="https://github.com/charles-azam" target="_blank" rel="noopener noreferrer" class="text-sm font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors">GitHub</a>
            <a href="https://huggingface.co/charles-azam" target="_blank" rel="noopener noreferrer" class="text-sm font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors">HuggingFace</a>
          </div>
        </div>

        <!-- FEM Canvas (React island) -->
        <div class="lg:order-1" id="fem-container">
          <!-- Skeleton placeholder (visible until React hydrates) -->
          <div id="fem-skeleton">
            <div class="border border-[var(--color-border)] rounded-t-lg bg-[var(--color-bg-secondary)] h-[380px] shadow-sm flex items-center justify-center">
              <p class="text-xs font-mono text-[var(--color-text-muted)] animate-pulse">Loading FEM solver...</p>
            </div>
            <div class="border border-t-0 border-[var(--color-border)] rounded-b-lg bg-[var(--color-bg-secondary)] h-[88px] shadow-sm"></div>
          </div>
          <FemHeroSection client:only="react" />
        </div>
      </div>
    </section>

    <!-- About -->
    <section class="mx-auto max-w-5xl px-6 py-10">
      <div class="flex items-start gap-5 p-6 rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-secondary)]">
        <img
          src="/headshot.jpg"
          alt="Charles Azam"
          class="w-20 h-20 rounded-full object-cover shrink-0 border-2 border-[var(--color-border)]"
        />
        <div>
          <p class="text-sm leading-relaxed text-[var(--color-text)]">
            I'm a scientific computing engineer turned Head of Software, currently building my own company. After years designing nuclear systems and leading engineering teams, I offer training and consulting services to bootstrap the venture. I believe the best engineering is code-driven, version-controlled, and built to last.
          </p>
          <a
            href="/consulting"
            class="inline-flex items-center gap-1.5 mt-3 text-sm font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors"
          >
            How I can help &rarr;
          </a>
        </div>
      </div>
    </section>

    <!-- Case Study -->
    <section class="mx-auto max-w-5xl px-6 pb-10">
      <div class="p-6 rounded-lg border border-[var(--color-accent)]/30 bg-[var(--color-accent-light)]">
        <p class="text-xs font-mono text-[var(--color-accent)] uppercase tracking-widest mb-2">Case Study</p>
        <h2 class="font-[var(--font-display)] text-xl text-[var(--color-text)] mb-1">Jimmy Energy</h2>
        <p class="text-xs font-mono text-[var(--color-text-muted)] mb-4">Head of Software & Comex member — 2022–2025</p>

        <p class="text-sm leading-relaxed mb-4">
          Jimmy Energy builds micro nuclear reactors to decarbonise industrial heat. When I joined, the engineering team relied on a legacy PLM and file-based workflows — a big design update took months.
        </p>

        <p class="text-sm font-semibold text-[var(--color-text)] mb-2">What we built</p>
        <ul class="space-y-2 mb-4">
          {[
            'Replaced the legacy PLM with a Python-based system (PyJimmy) where all systems are described in code',
            'Synchronized all teams via GitHub, with quality checks through pull requests',
            'Automated verification of regulatory requirements with GitHub Actions',
            'Built a RAG system on 1 million technical PDFs for knowledge retrieval',
          ].map((item) => (
            <li class="flex gap-3 text-sm">
              <span class="w-1 h-1 mt-2.5 rounded-full bg-[var(--color-accent)] shrink-0" />
              <span>{item}</span>
            </li>
          ))}
        </ul>

        <p class="text-sm font-semibold text-[var(--color-text)] mb-2">Results</p>
        <ul class="space-y-2 mb-5">
          {[
            'A big design update now takes days instead of the months expected in the industry',
            'Safer outcomes — automated checks and Python-coded relationships prevent copy-pasting errors',
            'Engineers spend time engineering instead of managing files',
            'Clean, versioned data enables AI workflows across the organisation',
          ].map((item) => (
            <li class="flex gap-3 text-sm">
              <span class="w-1 h-1 mt-2.5 rounded-full bg-[var(--color-accent)] shrink-0" />
              <span>{item}</span>
            </li>
          ))}
        </ul>

        <div class="p-4 rounded border border-[var(--color-border)] bg-[var(--color-bg-secondary)]">
          <p class="text-sm italic text-[var(--color-text-muted)] leading-relaxed mb-2">
            "A big update in their design takes them days instead of the many months expected in their industry. And the result is much safer, because the checks are automated and the relationships coded in Python prevent copy-pasting errors."
          </p>
          <a
            href="https://www.linkedin.com/feed/update/urn:li:activity:7240316043074666498/"
            target="_blank"
            rel="noopener noreferrer"
            class="text-xs font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors"
          >
            Read the full LinkedIn post &rarr;
          </a>
        </div>

        <p class="text-xs font-mono text-[var(--color-text-muted)] mt-4">Python, Git, AWS, GitHub Actions</p>
      </div>
    </section>

    <!-- Hackathon -->
    <section class="mx-auto max-w-5xl px-6 pb-10">
      <div class="flex items-center gap-4 p-5 rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-secondary)]">
        <span class="text-2xl shrink-0">&#127942;</span>
        <p class="text-sm leading-relaxed text-[var(--color-text)]">
          <span class="font-semibold">3rd place</span> at the
          <span class="font-semibold">HuggingFace x Anthropic Agentic Hackathon 2025</span>
          — built a travel booking agent and a web browsing tool for AI agents.
          <a href="/projects" class="font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors">See all projects &rarr;</a>
        </p>
      </div>
    </section>

    <!-- Writing -->
    <section class="mx-auto max-w-5xl px-6 py-12">
      <div class="flex items-baseline justify-between mb-8">
        <h2 class="font-[var(--font-display)] text-2xl text-[var(--color-text)]">Writing</h2>
        <a
          href="/blog"
          class="text-sm text-[var(--color-text-muted)] hover:text-[var(--color-accent)] link-underline transition-colors"
        >
          All posts
        </a>
      </div>
      <div class="space-y-0 divide-y divide-[var(--color-border)]">
        {posts.map((post) => (
          <a
            href={`/blog/${post.id.replace('.md', '')}`}
            class="group flex items-baseline justify-between py-4 gap-4"
          >
            <span class="text-[var(--color-text)] group-hover:text-[var(--color-accent)] transition-colors font-medium">
              {post.data.title}
            </span>
            <span class="text-xs text-[var(--color-text-muted)] whitespace-nowrap font-mono shrink-0">
              {new Date(post.data.date).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
            </span>
          </a>
        ))}
      </div>
    </section>
  </div>
</BaseLayout>

<script>
  // Fallback: if React fails to mount after 8s, show error instead of infinite loader
  setTimeout(() => {
    const skeleton = document.getElementById('fem-skeleton')
    if (skeleton) {
      const msg = skeleton.querySelector('p')
      if (msg) {
        msg.classList.remove('animate-pulse')
        msg.textContent = 'FEM solver could not load. Try refreshing the page.'
      }
    }
  }, 8000)
</script>
