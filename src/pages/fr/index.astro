---
import BaseLayout from '../../layouts/BaseLayout.astro'
import { FemHeroSection } from '../../components/FemHeroSection'
import { getCollection } from 'astro:content'

const featuredProjects = [
  {
    title: 'Jimmy Energy',
    tag: 'CIO',
    url: '/projects',
    description: 'Direction de la transformation d’une entreprise d’ingénierie traditionnelle vers un flux de travail basé sur Git.',
  },
  {
    title: 'OmniAgents',
    tag: 'Open Source',
    url: 'https://github.com/charles-azam/OmniAgents',
    description: 'Interface unifiée pour construire des agents de codage IA dans plusieurs environnements.',
  },
  {
    title: 'Predibench',
    tag: 'Live',
    url: 'https://predibench.com',
    description: 'Plateforme en direct évaluant les modèles d’IA sur les marchés de prédiction réels.',
  },
]

const posts = (await getCollection('blog'))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3)
---

<BaseLayout lang="fr">
  <div class="animate-page-in">
    <!-- Hero section -->
    <section class="mx-auto max-w-5xl px-6 pt-10 pb-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-start">
        <!-- Intro text -->
        <div class="lg:order-2 lg:pl-2">
          <p class="text-xs font-mono text-[var(--color-accent)] uppercase tracking-widest mb-3">
            Ingénieur Scientifique & Développeur IA
          </p>
          <h1 class="font-[var(--font-display)] text-5xl lg:text-[3.5rem] leading-[1.1] text-[var(--color-text)] mb-5">
            Charles Azam
          </h1>
          <p class="text-[15px] leading-relaxed mb-4 text-[var(--color-text)]">
            Le cadre à gauche est un véritable solveur d’éléments finis fonctionnant dans votre navigateur — 
            assemblant des matrices de rigidité, résolvant des problèmes de valeurs propres, rendant des déformées modales. 
            J’apporte la même rigueur d’ingénierie aux systèmes d’IA.
          </p>
          <p class="text-sm text-[var(--color-text-muted)] mb-6 leading-relaxed">
            Je construis actuellement des outils open-source pour les agents d’IA, les marchés de prédiction, 
            et la recherche technique. J’ai précédemment dirigé des équipes d’ingénierie chez Jimmy Energy, 
            transformant des flux de travail traditionnels en systèmes pilotés par le code.
          </p>
          <div class="flex gap-4">
            <a href="https://www.linkedin.com/in/charles-azam-a4223b135/" target="_blank" rel="noopener noreferrer" class="text-sm font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors">LinkedIn</a>
            <a href="https://github.com/charles-azam" target="_blank" rel="noopener noreferrer" class="text-sm font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors">GitHub</a>
            <a href="https://huggingface.co/charles-azam" target="_blank" rel="noopener noreferrer" class="text-sm font-mono text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] link-underline transition-colors">HuggingFace</a>
          </div>
        </div>

        <!-- FEM Canvas (React island) -->
        <div class="lg:order-1" id="fem-container">
          <div id="fem-skeleton">
            <div class="border border-[var(--color-border)] rounded-t-lg bg-[var(--color-bg-secondary)] h-[380px] shadow-sm flex items-center justify-center">
              <p class="text-xs font-mono text-[var(--color-text-muted)] animate-pulse">Chargement du solveur FEM...</p>
            </div>
            <div class="border border-t-0 border-[var(--color-border)] rounded-b-lg bg-[var(--color-bg-secondary)] h-[88px] shadow-sm"></div>
          </div>
          <FemHeroSection client:only="react" lang="fr" />
        </div>
      </div>
    </section>

    <!-- Featured Projects -->
    <section class="mx-auto max-w-5xl px-6 py-12">
      <div class="flex items-baseline justify-between mb-8">
        <h2 class="font-[var(--font-display)] text-2xl text-[var(--color-text)]">Projets</h2>
        <a
          href="/fr/projects"
          class="text-sm text-[var(--color-text-muted)] hover:text-[var(--color-accent)] link-underline transition-colors"
        >
          Tout voir
        </a>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
        {featuredProjects.map((project) => (
          <a
            href={project.url.startsWith('/') ? `/fr${project.url}` : project.url}
            target={project.url.startsWith('/') ? undefined : '_blank'}
            rel={project.url.startsWith('/') ? undefined : 'noopener noreferrer'}
            class="group block p-5 rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-secondary)] hover:border-[var(--color-accent)] hover:shadow-md transition-all"
          >
            <div class="flex items-center gap-2 mb-3">
              <h3 class="font-semibold text-[var(--color-text)] group-hover:text-[var(--color-accent)] transition-colors">
                {project.title}
              </h3>
              <span class="text-[10px] font-mono px-1.5 py-0.5 rounded bg-[var(--color-accent-light)] text-[var(--color-accent)]">
                {project.tag}
              </span>
            </div>
            <p class="text-sm text-[var(--color-text-muted)] leading-relaxed">{project.description}</p>
          </a>
        ))}
      </div>
    </section>

    <!-- Writing -->
    <section class="mx-auto max-w-5xl px-6 py-12">
      <div class="flex items-baseline justify-between mb-8">
        <h2 class="font-[var(--font-display)] text-2xl text-[var(--color-text)]">Articles</h2>
        <a
          href="/fr/blog"
          class="text-sm text-[var(--color-text-muted)] hover:text-[var(--color-accent)] link-underline transition-colors"
        >
          Tous les articles
        </a>
      </div>
      <div class="space-y-0 divide-y divide-[var(--color-border)]">
        {posts.map((post) => (
          <a
            href={`/fr/blog/${post.id.replace('.md', '')}`}
            class="group flex items-baseline justify-between py-4 gap-4"
          >
            <span class="text-[var(--color-text)] group-hover:text-[var(--color-accent)] transition-colors font-medium">
              {post.data.title_fr || post.data.title}
            </span>
            <span class="text-xs text-[var(--color-text-muted)] whitespace-nowrap font-mono shrink-0">
              {new Date(post.data.date).toLocaleDateString('fr-FR', { month: 'short', year: 'numeric' })}
            </span>
          </a>
        ))}
      </div>
    </section>
  </div>
</BaseLayout>

<script>
  const observer = new MutationObserver(() => {
    const container = document.getElementById('fem-container')
    if (container && container.querySelector('canvas')) {
      document.getElementById('fem-skeleton')?.remove()
      observer.disconnect()
    }
  })
  const container = document.getElementById('fem-container')
  if (container) {
    observer.observe(container, { childList: true, subtree: true })
  }
</script>
